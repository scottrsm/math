%% Needed for the postscript graphics.
%%\input epsf

%% My macros.
\input macro

%% The length of a page is 10in.
%%\vsize=10in

%\font\helv = phvr
%\font\times = ptmr
%\font\zap = pzcmi at 12pt
%\font\pal = pplro at 12pt

%% Don't indent paragraphs.
\parindent=0pt
\parskip=.5\baselineskip
\baselineskip = 1.1\baselineskip

\footline{\hss\tenrm\folio\hss}

\mansubtitle{Measure Theoretic Conditional Expectation}
        {in an Elementary Setting}
{R. Scott McIntire}{Sep 9, 2024}

\section{Overview}
The measure theoretic approach to conditional expectation can be confusing
when compared to the traditional approach -- especially in a discrete 
setting. In what follows we go through a conditional 
expectation problem within a discrete and familiar setting in an attempt 
to reduce this confusion. In the example shown, we show explicitly that the 
conditional expectation function is non-measurable in the origin 
measure space.


\section{Elementary Probability Example}
Let $X = \{D_1, D_2, D_3, D_4, D_5, D_6\}$ and define a function $P$ by 
$P(D_i) = \frac{1}{6}$, for $i\in \{1,2,3,4,5,6\}$. The intent is that $P$ will 
become a probability measure for the space we construct.
Let ${\cal E} = 2^X$ be the sigma  algebra 
consisting of the power set of $X$. We extend $P$ for every element in the sigma algebra.
Since the sigma algebra consists of all sets 
we need an assignment for an arbitrary set, $A$. 
The assignment is $P(A) = \frac{|A|}{6}$; that is the cardinality of the set divided by 6.
We now have a measure space; in fact, a probability space: $(P,X,{\cal E})$.
Note that for a probability space we need an event space, $X$, a sigma algebra of sets 
(in the discrete case just an algebra), and a function $P$ which takes 
elements of the sigma algebra to [0,1] with the property that 
$$
P\bigl(\mathop{\bigcup}_{i=1}^N A_i\bigr) = \sum_{i=1}^N P(A_i) 
\quad {\rm when}\;  A_k \cap A_j = \emptyset \quad k\neq j
$$

We now consider a random variable from which we will get a sub-sigma algebra.
Let 
$$
g(D_i) = \cases{0 & if $i$ is even;\cr
1 & if $i$ is odd \cr 
}
$$
In a discrete space the sigma algebra generated from $g$ is the algebra of sets generated from 
the sets:
$g^{-1}(0), g^{-1}(1), g^{-1}(a)$, for $a \neq 0,1$. It is not too hard to see that 
${\cal F} = \{\emptyset, \{1,3,5\}, \{2,4,6\}, \{1,2,3,4,5,6\}\}$.

For a discrete space a function, $f$, is measurable with respect to a sigma algebra if 
$f^{-1}(a)$ is an element in the sigma algebra for all $a\in (-\infty, \infty)$.
This has implications for the sigma algebra ${\cal F}$. 

The claim is that any function 
which is measurable over ${\cal F}$ has the property that $f$ is constant on the sets 
$\{1,3\}$ and $\{2,4,6\}$. More generally, we claim that any measurable function $f$ 
in ${\cal F}$ must be constant on the {\it minimal\/} elements of the algebra 
--  elements which have no non-trivial subsets.%
\footnote{\kern 0.5pt \raise 0.5ex \hbox{\dag}}{%
	Specifically, in a discrete setting, a set $Z$ in a sigma algebra, ${\cal H}$, is {\it minimal\/} in ${\cal H}$ if 
there is no non-empty, strict subset, $Y$, of $Z$ with $Y \in {\cal H}$.}

To see this suppose that $f(1)$ differs from $f(3)$.
Then $\{1, 3, 5\} \cap f^{-1}(f(1))$ is a non trivial subset of $\{1, 3, 5\}$ as is $\{1, 3, 5\} \cap f^{-1}(f(3))$.
These two sets must differ since $f(1)$ and $f(3)$ differ. 
Since ${\cal F}$ is a sigma algebra and 
$\{1, 3, 5\}$, $f^{-1}(f(1))$, and $f^{-1}(f(3))$ are sets in ${\cal F}$, any intersection of these
sets is also in ${\cal F}$. But since the two sets differ and are non-empty subsets of $\{1,3,5\}$, one 
of them must be a strict subset of $\{1,3,5\}$. And, since they are each in ${\cal F}$ with ${\cal F}$ an algebra 
of sets, this strict subset must be in ${\cal F}.$
However, we know that they also are {\it not\/} in ${\cal F}$ -- contradiction. 
Therefore, our premise that $f(1)$ and $f(3)$ could 
take differing values is incorrect.  The same argument shows that $f(1)$ and $f(5)$ do not differ.
The argument can be used to show that
$f$ is constant on the other minimal set $\{2,4,6\}$.

Notice that while any function over the measure space $(P,X,{\cal E})$ is measurable, we 
can write down a specific function that is non-measurable with respect to ${\cal F}$.
We know that all we have to do is come up with a function that differs on either of the 
sets $\{1, 3, 5\}$ or $\{2, 4, 6\}$. For instance, the function:  $f(D_i) = i$, for $i\in\{1,2,3,4,5,6\}$, 
is a non-measurable function in ${\cal F}$.

\section{Conditional Expectation}
Given a probability space $(P,X,{\cal E})$, the conditional expectation of a measurable 
function $f$ with respect to a sub-sigma algebra ${\cal F}$ is the unique ${\cal F}$ 
measurable function (random variable) labeled, $\E{f/{\cal F}}$, such that 
$$
\eqalignno{
\int_{\Lambda} \E{f/{\cal F}} \, dP & 
= \int_{\Lambda} f \, dP \quad \forall \Lambda \in {\cal F} & (1) \cr
}
$$
That is, $\E{f/{\cal F}}$ is a measurable function in the probability space $(P,X,{\cal F})$.
Although it seems that $f$ itself satisfies this equation you have to be careful. The function 
we are looking for must be measurable with respect to ${\cal F}$, and since ${\cal F}$ is 
a sub-sigma algebra of ${\cal E}$, it is quite possible that $f$ is not ${\cal F}$ measurable.
However, if $f$ is measurable with respect to ${\cal F}$ then it is its own conditional 
expectation. 

\section{Example Calculation of Conditional Expectation}
Consider the function from two sections back, $f(D_i) = i$, which is measurable in the 
space $(P,X,{\cal E})$. Let ${\cal F}$ be the sub-sigma algebra of that section.
We now compute the conditional expectation of $f$ with respect to ${\cal F}$.
Using (1) we choose two $\Lambda$'s: $\Lambda_1 = \{1,3,5\}$ and $\Lambda_2 = \{2,4,6\}$. 
We have
$$
\eqalignno{
\int_{\Lambda_1} \E{f/{\cal F}} \, dP & 
= \int_{\Lambda_1} f \, dP & (2) \cr
}
$$
and
$$
\eqalignno{
\int_{\Lambda_2} \E{f/{\cal F}} \, dP & 
= \int_{\Lambda_2} f \, dP & (3) \cr
}
$$
We know $\E{f/{\cal F}}$ is constant on $\Lambda_1$. We label this value as
$C_{\Lambda_1}$. From (2) we have 
$$
\eqalignno{
\int_{\Lambda_1} \E{f/{\cal F}} \, dP  & =  \int_{\Lambda_1} f \, dP & \cr
C_{\Lambda_1} \int_{\Lambda_1} \, dP & = \int_{\Lambda_1} f \, dP & \cr 
C_{\Lambda_1} * P(\Lambda_1) & =  \int_{\Lambda_1} f \, dP = f(D_1) * P(D_1) + f(D_3) * P(D_3) & \cr 
C_{\Lambda_1} * P(\Lambda_1) & = 1 * \frac{1}{6} + 3 * \frac{1}{6} + 5 * \frac{1}{6}  =  \frac{3}{2} & \cr
}
$$
Since $P(\Lambda_1) = \frac{3}{6} = \frac{1}{2}$, we have that 
$$
C_{\Lambda_1} = 3
$$
Consequently,
$$
\E{f/{\cal F}}(D_1) = \E{f/{\cal F}}(D_3) = C\E{f/{\cal F}}(D_5) = C_{\Lambda_1} = 3
$$
Likewise, $\E{f/{\cal F}}$ is constant on the set $\Lambda_2$. 
As we did above, we find the value of $\E{f/{\cal F}}$ on the set $\Lambda_2$.
Let $C_{\Lambda_2}$ be the constant value of $\E{f/{\cal F}}$ on $\Lambda_2$.
We have
$$
\eqalignno{
\int_{\Lambda_2} \E{f/{\cal F}} \, dP  & =  \int_{\Lambda_2} f \, dP & \cr
C_{\Lambda_2} \int_{\Lambda_2} \, dP & = \int_{\Lambda_2} f \, dP & (\dagger)\cr 
C_{\Lambda_2} * P(\Lambda_2) & = \int_{\Lambda_2} f \, dP = f(D_2) * P(D_2) + f(D_4) * P(D_4) + f(D_6) * P(6) & \cr 
C_{\Lambda_2} * P(\Lambda_2) & = 2 * \frac{1}{6} +  4 * \frac{1}{6} + 6 * \frac{1}{6} = 2 & \cr
}
$$
Since $P(\Lambda_2) = \frac{3}{6} = \frac{1}{2}$, we have that 
$$
C_{\Lambda_2} = 4
$$
Consequently,
$$
\E{f/{\cal F}}(D_2) = \E{f/{\cal F}}(D_4) = \E{f/{\cal F}}(D_6) = C_{\Lambda_2} = 4
$$
Since a function is determined once we know what its values are on every $x \in X$, 
we have found the conditional expectation function, $\E{f/{\cal F}}$, as we know 
its values on every $x \in X$.

From equation $(\dagger)$ we see, that the value of the function $\E{f/{\cal F}}$ 
evaluated on any `x` value in a minimal set, $\Lambda$, is% 
\footnote{\kern 0.5pt \raise 0.5ex \hbox{\ddag}}{%
This {\it assumes\/} that $P(\Lambda) \ne 0$.}	
$$
\eqalignno{
	\E{f/{\cal F}}(x) & = \frac{\int_\Lambda f \, dP}{P(\Lambda)} & (\ddag) \cr
}
$$
More generally, discrete probability or otherwise, we may think of the 
sigma algebra, ${\cal F}$, as a coarser ``mesh'' than the sigma algebra, ${\cal E}$.
And we can think of the value of $\E{f/{\cal F}}$ on any ``minimal'' element 
of the mesh as the average of the function, $f$, over this minimal 
element with respect to the finer ``mesh'' -- the sigma algebra, ${\cal E}$.

You can think of the conditional expectation as giving the ``best'' representation 
of a function given a cruder mesh, ${\cal F}$, than the refined mesh, ${\cal E}$. 
Just as the ``best'' representation of an image at a larger pixel (crude mesh) would be an 
average over the smaller pixels (refined mesh) of the larger pixel.
 
\section{Example Redux}
Let's adjust the dice example probabilities and redo the calculation of the 
conditional expectation. Set the probability measure, $P$, as:
$$
\eqalignno{
	P(D_i) & = 0 \quad  i \in \Lambda_1 = \{1,3,5\}  & \cr
	P(D_i) & =  \frac{1}{3} \quad i \in \Lambda_2 = \{2,4,6\} & \cr
}
$$
In this case we can find the value of $\E{f/{\cal F}}$ on the set $\Lambda_2$ as before. 
However, we can't find its value on the set $\Lambda_1$ since $P(\Lambda_1) = 0$. 
In the case of $\Lambda_1$, the equation $(\ddag)$ will not help us determine 
the value of $\E{f/{\cal F}}$ on $\Lambda_1$.

Effectively, it turns out, we don't have to determine the values with any specificity.
We can {\it set\/} the values of $\E{f/{\cal F}}$ to $0$; or, to any other value 
for that matter. The reason for this is that the definition of
conditional expectation determines a unique element in the function space on ${\cal F}$
\footnote{\kern 0.5pt \raise 0.5ex \hbox{\dag}}{%
We know that $\Lambda_1$ is minimal so for the conditional expectation function to be measurable 
it must have the same value on all elements of $\Lambda_1$.}.
However, each element in such a space is actually an equivalence class of 
measurable functions over ${\cal F}$ who differ by at most a set of measure $0$. 

We can't directly compute what the value of a representative of $\E{f/{\cal F}}$ is on 
the set $\Lambda_1$ but we don't have to, since any value will give us a function that is equivalent.
Therefore, we may take $\E{f/{\cal F}}$ to be $0$ on $\Lambda_1$.
Since we know the value of $\E{f/{\cal F}}$ over all input values in $X$, we have determined
the conditional expectation.

\bye


